---
phase: 04-blazor-package
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/Imagile.Framework.Blazor.ApplicationInsights/Logging/ApplicationInsightsLogger.cs
  - src/Imagile.Framework.Blazor.ApplicationInsights/Logging/ApplicationInsightsLoggerProvider.cs
  - src/Imagile.Framework.Blazor.ApplicationInsights/Logging/ApplicationInsightsLoggerOptions.cs
  - src/Imagile.Framework.Blazor.ApplicationInsights/Logging/NoOpDisposable.cs
autonomous: true

must_haves:
  truths:
    - "ILoggerProvider sends all ILogger calls to Application Insights as traces"
    - "Logger respects minimum log level configuration"
    - "Logger includes category name in trace properties"
    - "Logger only active in browser (WASM) environment, not Blazor Server"
  artifacts:
    - path: "src/Imagile.Framework.Blazor.ApplicationInsights/Logging/ApplicationInsightsLoggerProvider.cs"
      provides: "ILoggerProvider implementation for DI"
      contains: "class ApplicationInsightsLoggerProvider : ILoggerProvider"
    - path: "src/Imagile.Framework.Blazor.ApplicationInsights/Logging/ApplicationInsightsLogger.cs"
      provides: "ILogger implementation that sends to App Insights"
      contains: "class ApplicationInsightsLogger"
    - path: "src/Imagile.Framework.Blazor.ApplicationInsights/Logging/ApplicationInsightsLoggerOptions.cs"
      provides: "Configuration for log shipping"
      contains: "class ApplicationInsightsLoggerOptions"
  key_links:
    - from: "ApplicationInsightsLoggerProvider"
      to: "IApplicationInsights"
      via: "constructor injection"
      pattern: "IApplicationInsights _appInsights"
    - from: "ApplicationInsightsLogger"
      to: "IApplicationInsights.TrackTrace"
      via: "Log method"
      pattern: "TrackTrace"
---

<objective>
Migrate the ILoggerProvider integration that ships ILogger calls to Application Insights as trace telemetry.

Purpose: Allow existing logging code in Blazor WASM apps to automatically appear in Application Insights without refactoring. Standard ILogger<T> calls become TrackTrace calls.

Output: Complete logging integration that can be enabled via addWasmLogger parameter in AddBlazorApplicationInsights().
</objective>

<execution_context>
@C:\Users\kolat\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\kolat\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-blazor-package/04-RESEARCH.md
@.planning/phases/04-blazor-package/04-01-SUMMARY.md

Source repository for migration:
@C:\Code\Imagile.BlazorApplicationInsights\src\Imagile.BlazorApplicationInsights\Logging\ApplicationInsightsLogger.cs
@C:\Code\Imagile.BlazorApplicationInsights\src\Imagile.BlazorApplicationInsights\Logging\ApplicationInsightsLoggerProvider.cs
@C:\Code\Imagile.BlazorApplicationInsights\src\Imagile.BlazorApplicationInsights\Logging\ApplicationInsightsLoggerOptions.cs
@C:\Code\Imagile.BlazorApplicationInsights\src\Imagile.BlazorApplicationInsights\Logging\NoOpDisposable.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Logger Options and NoOp Helper</name>
  <files>
    src/Imagile.Framework.Blazor.ApplicationInsights/Logging/ApplicationInsightsLoggerOptions.cs
    src/Imagile.Framework.Blazor.ApplicationInsights/Logging/NoOpDisposable.cs
  </files>
  <action>
    Create Logging/ folder and migrate supporting types.

    ApplicationInsightsLoggerOptions.cs:
    1. Change namespace from `Imagile.BlazorApplicationInsights.Logging` to `Imagile.Framework.Blazor.ApplicationInsights.Logging`
    2. This class contains MinimumLogLevel property (defaults to LogLevel.Information)
    3. Preserve any other configuration options for log filtering

    NoOpDisposable.cs:
    1. Change namespace to `Imagile.Framework.Blazor.ApplicationInsights.Logging`
    2. This is a simple IDisposable that does nothing (for IOptionsMonitor.OnChange)
    3. Uses singleton pattern: Instance property

    These are simple helper types that the main logger classes depend on.
  </action>
  <verify>
    Files exist: `dir src\Imagile.Framework.Blazor.ApplicationInsights\Logging\*.cs /b`
    Should list ApplicationInsightsLoggerOptions.cs and NoOpDisposable.cs
  </verify>
  <done>Logger options and NoOp helper migrated to Logging/ folder</done>
</task>

<task type="auto">
  <name>Task 2: Migrate Logger Provider and Logger Implementation</name>
  <files>
    src/Imagile.Framework.Blazor.ApplicationInsights/Logging/ApplicationInsightsLoggerProvider.cs
    src/Imagile.Framework.Blazor.ApplicationInsights/Logging/ApplicationInsightsLogger.cs
  </files>
  <action>
    Migrate the core logging integration classes.

    ApplicationInsightsLoggerProvider.cs:
    1. Change namespace to `Imagile.Framework.Blazor.ApplicationInsights.Logging`
    2. Update using statements for interfaces to new namespace
    3. Implements ILoggerProvider
    4. Takes IApplicationInsights and IOptionsMonitor<ApplicationInsightsLoggerOptions> in constructor
    5. CreateLogger returns ApplicationInsightsLogger instance

    ApplicationInsightsLogger.cs:
    1. Change namespace to `Imagile.Framework.Blazor.ApplicationInsights.Logging`
    2. Update using statements for models (SeverityLevel, TraceTelemetry)
    3. Implements ILogger
    4. Log<TState>() method:
       - Converts LogLevel to SeverityLevel
       - Creates TraceTelemetry with message and properties
       - Calls _appInsights.TrackTrace()
    5. IsEnabled() checks against MinimumLogLevel from options
    6. BeginScope() returns NoOpDisposable (scopes not supported in WASM)

    Key implementation details:
    - Logger is async-void internally (fire-and-forget to not block logging)
    - Category name added to trace properties
    - Exception details included when present
  </action>
  <verify>
    Build: `dotnet build src/Imagile.Framework.Blazor.ApplicationInsights -c Release`
    Should compile successfully
  </verify>
  <done>Logger provider and logger implementation migrated, package compiles</done>
</task>

<task type="auto">
  <name>Task 3: Verify Integration with DI Extensions</name>
  <files>
    src/Imagile.Framework.Blazor.ApplicationInsights/IServiceCollectionExtensions.cs
  </files>
  <action>
    Verify IServiceCollectionExtensions.cs correctly references the logging types.

    Check that AddBlazorApplicationInsights():
    1. Has addWasmLogger parameter (default true)
    2. References ApplicationInsightsLoggerProvider from Logging namespace
    3. Only registers logger provider when IsBrowserPlatform is true
    4. Uses TryAddEnumerable for ILoggerProvider registration

    The DI registration should already be migrated in Plan 02. This task verifies the logging types integrate correctly.

    If any using statements are missing, add them:
    - using Imagile.Framework.Blazor.ApplicationInsights.Logging;

    Build full solution to verify all pieces work together.
  </action>
  <verify>
    Full build: `dotnet build Imagile.Framework.sln -c Release`
    Check IServiceCollectionExtensions references logging types correctly
  </verify>
  <done>Logging integration verified, solution builds successfully</done>
</task>

</tasks>

<verification>
- All four logging files exist in Logging/ folder
- ApplicationInsightsLoggerProvider implements ILoggerProvider
- ApplicationInsightsLogger implements ILogger
- Log level mapping: LogLevel -> SeverityLevel is correct
- Solution builds: `dotnet build Imagile.Framework.sln -c Release`
- No circular dependencies between Logging and root namespace
</verification>

<success_criteria>
- ILoggerProvider integration complete
- Log calls routed to TrackTrace
- Browser-only activation preserved (IsBrowserPlatform check)
- Minimum log level configuration working
- Solution compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-blazor-package/04-03-SUMMARY.md`
</output>
