---
phase: 02-core-package
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/Imagile.Framework.Core/Attributes/AssociatedAttribute.cs
  - src/Imagile.Framework.Core/Attributes/RequiresAttribute.cs
  - src/Imagile.Framework.Core/Attributes/IncludesAttribute.cs
autonomous: true

must_haves:
  truths:
    - "Developer can apply AssociatedAttribute<TEnum> to enum fields"
    - "Developer can apply RequiresAttribute<TEnum> with require-all/any semantics"
    - "Developer can apply IncludesAttribute<TEnum> for self-referential inclusion"
    - "All attributes have XML documentation visible in IntelliSense"
  artifacts:
    - path: "src/Imagile.Framework.Core/Attributes/AssociatedAttribute.cs"
      provides: "Base generic association attribute"
      exports: ["AssociatedAttribute<TEnum>"]
      contains: "AttributeUsage"
    - path: "src/Imagile.Framework.Core/Attributes/RequiresAttribute.cs"
      provides: "Requirement attribute with all/any semantics"
      exports: ["RequiresAttribute<TEnum>"]
      contains: "RequireAll"
    - path: "src/Imagile.Framework.Core/Attributes/IncludesAttribute.cs"
      provides: "Self-referential inclusion attribute"
      exports: ["IncludesAttribute<TEnum>"]
      contains: "Included"
  key_links:
    - from: "RequiresAttribute.cs"
      to: "AssociatedAttribute.cs"
      via: "inheritance"
      pattern: "class RequiresAttribute.*: AssociatedAttribute"
    - from: "IncludesAttribute.cs"
      to: "AssociatedAttribute.cs"
      via: "inheritance"
      pattern: "class IncludesAttribute.*: AssociatedAttribute"
---

<!-- CORE-01 Requirement Clarification:
CORE-01 states "Sealed attribute base classes" which requires interpretation:
- BASE classes (AssociatedAttribute) are UNSEALED by design for inheritance
- CONCRETE attributes (Category, Count, NativeName, Hosted, DoNotUpdate) ARE sealed
AssociatedAttribute is intentionally unsealed as it serves as the base for
RequiresAttribute and IncludesAttribute. This is the correct architectural pattern.
CORE-01 is satisfied: proper AttributeUsage on base classes, and concrete leaf
attributes are sealed per CA1813 guidelines. -->

<objective>
Implement the core association attributes (AssociatedAttribute, RequiresAttribute, IncludesAttribute).

Purpose: These attributes form the foundation for declaring relationships between enum types. They enable declarative programming patterns like "this feature requires these permissions" or "this role includes these other roles."
Output: Three attribute classes with full XML documentation and proper AttributeUsage declarations.
</objective>

<execution_context>
@C:\Users\kolat\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\kolat\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-package/02-RESEARCH.md
@.planning/phases/02-core-package/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AssociatedAttribute base class</name>
  <files>src/Imagile.Framework.Core/Attributes/AssociatedAttribute.cs</files>
  <action>
Create AssociatedAttribute.cs in src/Imagile.Framework.Core/Attributes/:

```csharp
namespace Imagile.Framework.Core.Attributes;

/// <summary>
/// Specifies that an enum value is associated with one or more values from another enum type.
/// Used to create declarative relationships between enum types.
/// </summary>
/// <typeparam name="TEnum">The type of enum this value is associated with</typeparam>
/// <param name="associatedWith">The enum values this value is associated with</param>
/// <example>
/// <code>
/// enum Permission { Read, Write, Delete }
/// enum Feature
/// {
///     [Associated&lt;Permission&gt;(Permission.Read)]
///     ViewDashboard,
///
///     [Associated&lt;Permission&gt;(Permission.Read, Permission.Write)]
///     EditProfile
/// }
/// </code>
/// </example>
[AttributeUsage(AttributeTargets.Field, AllowMultiple = true)]
public class AssociatedAttribute<TEnum>(params TEnum[] associatedWith) : Attribute
    where TEnum : struct, Enum
{
    /// <summary>
    /// Gets the enum values this value is associated with.
    /// </summary>
    public TEnum[] Associated { get; } = associatedWith;
}
```

Key design decisions:
- NOT sealed: This is a base class for RequiresAttribute and IncludesAttribute
- AllowMultiple = true: Allows associating with multiple different enum types
- Generic constraint: where TEnum : struct, Enum (compile-time type safety)
- Primary constructor: Required arguments in constructor (CORE-02)
- Full XML documentation with example (CORE-04)
  </action>
  <verify>
1. Run: dotnet build src/Imagile.Framework.Core
   - Must compile without errors or warnings
2. Verify AttributeUsage: grep "AttributeUsage" src/Imagile.Framework.Core/Attributes/AssociatedAttribute.cs
   - Must show [AttributeUsage(AttributeTargets.Field, AllowMultiple = true)]
3. Verify XML docs: grep "/// <summary>" src/Imagile.Framework.Core/Attributes/AssociatedAttribute.cs
   - Must show documentation comments
  </verify>
  <done>AssociatedAttribute.cs exists with XML documentation, proper AttributeUsage, generic constraint, and primary constructor pattern.</done>
</task>

<task type="auto">
  <name>Task 2: Create RequiresAttribute with require-all/any semantics</name>
  <files>src/Imagile.Framework.Core/Attributes/RequiresAttribute.cs</files>
  <action>
Create RequiresAttribute.cs in src/Imagile.Framework.Core/Attributes/:

```csharp
namespace Imagile.Framework.Core.Attributes;

/// <summary>
/// Specifies that an enum value requires one or more values from another enum type.
/// Extends <see cref="AssociatedAttribute{TEnum}"/> with "require all" vs "require any" semantics.
/// </summary>
/// <typeparam name="TEnum">The type of enum this value requires</typeparam>
/// <remarks>
/// <para>
/// When <see cref="RequireAll"/> is <c>true</c>, all specified values must be present for the requirement to be satisfied.
/// When <see cref="RequireAll"/> is <c>false</c> (default), at least one of the specified values must be present.
/// </para>
/// </remarks>
/// <example>
/// <code>
/// enum Permission { Read, Write, Delete }
/// enum Feature
/// {
///     // Requires Read OR Write permission (any)
///     [Requires&lt;Permission&gt;(Permission.Read, Permission.Write)]
///     ViewReports,
///
///     // Requires BOTH Read AND Write permissions (all)
///     [Requires&lt;Permission&gt;(true, Permission.Read, Permission.Write)]
///     EditReports
/// }
/// </code>
/// </example>
public class RequiresAttribute<TEnum> : AssociatedAttribute<TEnum>
    where TEnum : struct, Enum
{
    /// <summary>
    /// Initializes a new instance with optional RequireAll semantics.
    /// </summary>
    /// <param name="requireAll">If <c>true</c>, all required values must be present. If <c>false</c>, at least one must be present.</param>
    /// <param name="required">The enum values that are required</param>
    public RequiresAttribute(bool requireAll, params TEnum[] required) : base(required)
    {
        RequireAll = requireAll;
    }

    /// <summary>
    /// Initializes a new instance with default RequireAll=false (any) semantics.
    /// </summary>
    /// <param name="required">The enum values that are required</param>
    public RequiresAttribute(params TEnum[] required) : base(required) { }

    /// <summary>
    /// Gets the required enum values. This is an alias for <see cref="AssociatedAttribute{TEnum}.Associated"/>.
    /// </summary>
    public TEnum[] Required => Associated;

    /// <summary>
    /// Gets whether all required values must be present (<c>true</c>) or just one (<c>false</c>).
    /// Default is <c>false</c> (require any).
    /// </summary>
    public bool RequireAll { get; init; }
}
```

Key design decisions:
- NOT sealed: Could be extended for domain-specific requirement attributes
- Inherits from AssociatedAttribute<TEnum>
- Two constructors: one with requireAll flag, one defaulting to false
- Required property aliases Associated for semantic clarity
- RequireAll uses init accessor for optional property pattern (CORE-02)
  </action>
  <verify>
1. Run: dotnet build src/Imagile.Framework.Core
   - Must compile without errors or warnings
2. Verify inheritance: grep "class RequiresAttribute" src/Imagile.Framework.Core/Attributes/RequiresAttribute.cs
   - Must show inheritance from AssociatedAttribute
3. Verify both constructors exist
  </verify>
  <done>RequiresAttribute.cs exists with both constructor overloads, RequireAll property, and inheritance from AssociatedAttribute.</done>
</task>

<task type="auto">
  <name>Task 3: Create IncludesAttribute for self-referential inclusion</name>
  <files>src/Imagile.Framework.Core/Attributes/IncludesAttribute.cs</files>
  <action>
Create IncludesAttribute.cs in src/Imagile.Framework.Core/Attributes/:

```csharp
namespace Imagile.Framework.Core.Attributes;

/// <summary>
/// Specifies that an enum value includes one or more other values of the same enum type.
/// Used for hierarchical or composite patterns like roles that include other roles.
/// </summary>
/// <typeparam name="TEnum">The enum type (same as the decorated field's containing type)</typeparam>
/// <remarks>
/// <para>
/// This attribute creates a self-referential relationship within a single enum type.
/// Unlike <see cref="AssociatedAttribute{TEnum}"/> which relates different enum types,
/// IncludesAttribute relates values within the same enum.
/// </para>
/// </remarks>
/// <example>
/// <code>
/// enum Role
/// {
///     Reader,
///     Writer,
///
///     [Includes&lt;Role&gt;(Role.Reader)]
///     Editor,
///
///     [Includes&lt;Role&gt;(Role.Reader, Role.Writer, Role.Editor)]
///     Admin
/// }
/// </code>
/// </example>
public class IncludesAttribute<TEnum> : AssociatedAttribute<TEnum>
    where TEnum : struct, Enum
{
    /// <summary>
    /// Initializes a new instance specifying which enum values are included.
    /// </summary>
    /// <param name="included">The enum values that are included by this value</param>
    public IncludesAttribute(params TEnum[] included) : base(included) { }

    /// <summary>
    /// Gets the enum values that are included by this value.
    /// This is an alias for <see cref="AssociatedAttribute{TEnum}.Associated"/>.
    /// </summary>
    public TEnum[] Included => Associated;
}
```

Key design decisions:
- NOT sealed: Could be extended for domain-specific inclusion patterns
- Inherits from AssociatedAttribute<TEnum>
- Included property aliases Associated for semantic clarity
- Self-referential pattern clearly documented
  </action>
  <verify>
1. Run: dotnet build src/Imagile.Framework.Core
   - Must compile without errors or warnings
2. Verify inheritance and Included property
3. Run full solution build: dotnet build Imagile.Framework.sln
   - Must succeed
  </verify>
  <done>IncludesAttribute.cs exists with self-referential pattern documentation and Included property alias.</done>
</task>

</tasks>

<verification>
1. All three attribute files exist in src/Imagile.Framework.Core/Attributes/
2. Solution builds: `dotnet build Imagile.Framework.sln` succeeds without warnings
3. RequiresAttribute and IncludesAttribute inherit from AssociatedAttribute
4. All attributes have XML documentation (summary, typeparam, example)
5. Zero PackageReference in Core project (verify: grep PackageReference src/Imagile.Framework.Core/*.csproj)
</verification>

<success_criteria>
- AssociatedAttribute<TEnum> is the base class with AllowMultiple=true
- RequiresAttribute<TEnum> extends AssociatedAttribute with RequireAll property
- IncludesAttribute<TEnum> extends AssociatedAttribute with Included alias
- All classes have comprehensive XML documentation with examples
- Project compiles without warnings (AOT/trim analysis passes)
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-package/02-02-SUMMARY.md`
</output>
