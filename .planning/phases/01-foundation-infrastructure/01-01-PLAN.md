---
phase: 01-foundation-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Directory.Build.props
  - Directory.Packages.props
  - GitVersion.yml
autonomous: true

must_haves:
  truths:
    - "All projects inherit shared package metadata from Directory.Build.props"
    - "All package versions are centralized in Directory.Packages.props"
    - "GitVersion generates version 0.0.1 for initial builds"
    - "XML documentation generates for all projects"
    - "Native AOT analysis is enabled for framework packages"
  artifacts:
    - path: "Directory.Build.props"
      provides: "Shared MSBuild properties for all projects"
      contains: "GenerateDocumentationFile"
    - path: "Directory.Packages.props"
      provides: "Centralized package version management"
      contains: "ManagePackageVersionsCentrally"
    - path: "GitVersion.yml"
      provides: "Semantic versioning configuration starting at 0.0.1"
      contains: "next-version"
  key_links:
    - from: "Directory.Build.props"
      to: "all .csproj files"
      via: "MSBuild automatic import"
      pattern: "implicit import at solution root"
    - from: "Directory.Packages.props"
      to: "all .csproj PackageReference"
      via: "Central Package Management"
      pattern: "VersionOverride not needed"
---

<objective>
Create build infrastructure files for centralized configuration, versioning, and documentation generation.

Purpose: Establish foundation for multi-package development with consistent metadata, centralized dependency management, and automatic versioning from Git history.

Output: Three configuration files at solution root that all current and future projects will inherit.
</objective>

<execution_context>
@C:\Users\kolat\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\kolat\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@Imagile.EntityFrameworkCore.Tests/Imagile.EntityFrameworkCore.Tests.csproj
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Directory.Build.props with shared metadata and build settings</name>
  <files>Directory.Build.props</files>
  <action>
Create Directory.Build.props at solution root with:

**Package Metadata (shared across all packages):**
- Authors: Imagile
- Company: Imagile
- PackageLicenseExpression: MIT
- RepositoryUrl: https://github.com/imagile/imagile-framework
- RepositoryType: git
- PackageProjectUrl: https://github.com/imagile/imagile-framework

**Build Settings:**
- TargetFramework: net10.0 (enforce .NET 10 for all projects)
- ImplicitUsings: enable
- Nullable: enable
- LangVersion: latest

**Documentation:**
- GenerateDocumentationFile: true
- NoWarn: $(NoWarn);1591 (suppress missing XML doc warnings initially)

**AOT/Trimming Analysis:**
- IsTrimmable: true
- IsAotCompatible: true
- EnableTrimAnalyzer: true

**Conditional settings:**
- Only apply IsPackable=true for non-test projects (use Condition on project name patterns)
  </action>
  <verify>
Run `dotnet build` from solution root - should succeed and generate XML documentation file in bin/Debug/net10.0/
  </verify>
  <done>
Directory.Build.props exists at solution root with all specified properties. All projects inherit shared settings.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Directory.Packages.props for Central Package Management</name>
  <files>Directory.Packages.props</files>
  <action>
Create Directory.Packages.props at solution root with:

**Enable Central Package Management:**
```xml
<ManagePackageVersionsCentrally>true</ManagePackageVersionsCentrally>
```

**Package Versions (extracted from current csproj):**
- Microsoft.EntityFrameworkCore: 10.0.0
- Microsoft.EntityFrameworkCore.Sqlite: 10.0.0
- Microsoft.Data.Sqlite: 10.0.0
- xunit: 2.9.3
- FluentAssertions: 6.12.0
- Humanizer.Core: 3.0.1

**Future packages (add as placeholders in comments):**
- Microsoft.ApplicationInsights (for Blazor package)
- Microsoft.JSInterop (for Blazor package)

After creating, update Imagile.EntityFrameworkCore.Tests.csproj to remove Version attributes from PackageReference elements (Central Package Management takes over).
  </action>
  <verify>
Run `dotnet restore` - should succeed without version conflicts. Run `dotnet build` - should compile successfully.
  </verify>
  <done>
Directory.Packages.props exists with ManagePackageVersionsCentrally=true. All package versions centralized. Project csproj files use PackageReference without Version attribute.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update GitVersion.yml for initial 0.0.1 version</name>
  <files>GitVersion.yml</files>
  <action>
Update existing GitVersion.yml to:

1. Add next-version property at root level to set starting version:
```yaml
next-version: 0.0.1
```

2. Keep existing mainline mode and branch configuration (already well-configured).

3. The next-version setting ensures first build on main produces 0.0.1 instead of default 0.1.0.

This signals early alpha status while allowing increment to 1.0.0 when production-ready.
  </action>
  <verify>
Run `dotnet tool install GitVersion.Tool -g` (if not installed), then `dotnet-gitversion /showvariable SemVer` - should output version starting with 0.0.
  </verify>
  <done>
GitVersion.yml contains next-version: 0.0.1 setting. GitVersion outputs 0.0.x versions for builds.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build` succeeds from solution root
2. XML documentation file generated in output directory
3. `dotnet restore` completes without version warnings
4. `dotnet-gitversion /showvariable SemVer` returns 0.0.x version
5. No duplicate package version declarations (central management working)
</verification>

<success_criteria>
- Directory.Build.props exists at C:\Code\imagile-framework\Directory.Build.props
- Directory.Packages.props exists at C:\Code\imagile-framework\Directory.Packages.props
- GitVersion.yml updated with next-version: 0.0.1
- `dotnet build` passes for all projects
- Generated XML documentation file exists after build
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md`
</output>
